{"version":3,"sources":["bill.js"],"names":["express","require","connection","router","Router","ejs","pdf","path","fs","uuid","auth","json","post","authenticateToken","req","res","generateuuid","v1","orderDetails","body","productDetailsReport","JSON","parse","productDetails","query","name","email","contactNumber","paymentMethod","totalAmount","locals","err","results","renderFile","join","__dirname","status","create","toFile","data","console","log","pdfPath","existsSync","contentType","createReadStream","pipe","get","next","id","params","affectedRows","message","module","exports"],"mappings":"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","sourcesContent":["const express=require('express');\r\nconst connection=require('../connection');\r\nconst router=express.Router();\r\nlet ejs=require('ejs');\r\nlet pdf=require('html-pdf');\r\nlet path=require('path');\r\nvar fs=require('fs');\r\nvar uuid=require('uuid');\r\nvar auth=require('../services/authentication');\r\nconst { json } = require('stream/consumers');\r\n\r\nrouter.post('/generateReport',auth.authenticateToken,(req,res)=>{\r\n    const generateuuid=uuid.v1();\r\n    const orderDetails=req.body;\r\n    var productDetailsReport=JSON.parse(orderDetails.productDetails);\r\n\r\n    var query=\"insert into bill (name,uuid,email,contactNumber,paymentMethod,total,productDetails,createdBy) values(?,?,?,?,?,?,?,?)\";\r\n    connection.query(query,[orderDetails.name,generateuuid,orderDetails.email,orderDetails.contactNumber,orderDetails.paymentMethod,orderDetails.totalAmount,orderDetails.productDetails,res.locals.email],(err,results)=>{\r\n        if(!err){\r\n            ejs.renderFile(path.join(__dirname,'',\"report.ejs\"),{productDetails:productDetailsReport,name:orderDetails.name,\r\n                email:orderDetails.email,contactNumber:orderDetails.contactNumber,paymentMethod:orderDetails.paymentMethod,\r\n                totalAmount:orderDetails.totalAmount},(err,results)=>{\r\n                    if(err){\r\n                        return res.status(500).json(err);\r\n                    }else{\r\n                    pdf.create(results).toFile('./generate_pdf/'+generateuuid+\".pdf\",function(err,data){\r\n                        if(err){\r\n                            console.log(err);\r\n                            return res.status(500).json(err);\r\n                        }\r\n                        else{\r\n                            return res.status(200).json({uuid:generateuuid});\r\n                        }\r\n                    })\r\n                }\r\n                    \r\n                })\r\n        }else{\r\n            return res.status(500).json(err);\r\n        }\r\n    })\r\n\r\n})\r\n\r\nrouter.post('/getPdf',auth.authenticateToken,function(req,res){\r\n    const orderDetails=req.body;\r\n    const pdfPath='./generate_pdf/'+orderDetails.uuid+'.pdf';\r\n    if(fs.existsSync(pdfPath)){\r\n        res.contentType(\"application/pdf\");\r\n        fs.createReadStream(pdfPath).pipe(res);\r\n    }\r\n    else{\r\n        var productDetailsReport=JSON.parse(orderDetails.productDetails);\r\n        ejs.renderFile(path.join(__dirname,'',\"report.ejs\"),{productDetails:productDetailsReport,name:orderDetails.name,email:orderDetails.email,contactNumber:orderDetails.contactNumber,paymentMethod:orderDetails.paymentMethod,totalAmount:orderDetails.totalAmount},(err,results)=>{\r\n            if(err){\r\n                return res.status(500).json(err);\r\n            }\r\n            else{\r\n                pdf.create(results).toFile('./generate_pdf/'+orderDetails.uuid+\".pdf\",function(err,results){\r\n                    if(err){\r\n                        console.log(err);\r\n                        return res.status(500).json(err);\r\n                    }\r\n                    else{\r\n                        res.contentType(\"application/pdf\");\r\n                        fs.createReadStream(pdfPath).pipe(res);\r\n                    }\r\n                })\r\n            }\r\n        })\r\n    }\r\n})\r\n\r\nrouter.get('/getBills',auth.authenticateToken,(req,res,next)=>{\r\n    var query=\"select * from bill order by id DESC\";\r\n    connection.query(query,(err,results)=>{\r\n        if(!err){\r\n            return res.status(200).json(results);\r\n        }\r\n        else{\r\n            return res.status(500).json(err);\r\n        }\r\n    })\r\n})\r\n\r\nrouter.delete('/delete/:id',auth.authenticateToken,(req,res,next)=>{\r\n    const id=req.params.id;\r\n    var query=\"delete from bill where id=?\";\r\n    connection.query(query,[id],(err,results)=>{\r\n        if(!err){\r\n            if(results.affectedRows == 0){\r\n                return res.status(404).json({message:\"Bill id does not found\"});\r\n            }\r\n            return res.status(200).json({message:\"Bill Deleted Successfully\"});\r\n        }\r\n        else{\r\n            return res.status(500).json(err);\r\n        }\r\n    })\r\n})\r\nmodule.exports=router;"],"file":"bill.dev.js"}